-- Settings
local Teams = game:GetService("Teams")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

-- Check if we have a valid team system (optional, since not all games have teams)
local myTeam = LocalPlayer.Team

-- Create GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CheatGUI"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 400)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.Parent = ScreenGui
MainFrame.Visible = false

-- Buttons for each function
local AimbotButton = Instance.new("TextButton")
AimbotButton.Size = UDim2.new(0, 200, 0, 50)
AimbotButton.Position = UDim2.new(0.5, -100, 0, 10)
AimbotButton.Text = "Toggle Aimbot"
AimbotButton.Parent = MainFrame

local ESPButton = Instance.new("TextButton")
ESPButton.Size = UDim2.new(0, 200, 0, 50)
ESPButton.Position = UDim2.new(0.5, -100, 0, 70)
ESPButton.Text = "Toggle ESP"
ESPButton.Parent = MainFrame

-- Keybind for GUI Toggle (Press INS)
local guiVisible = false
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if input.KeyCode == Enum.KeyCode.Insert and not gameProcessedEvent then
        guiVisible = not guiVisible
        MainFrame.Visible = guiVisible
    end
end)

-- Helper function to find the closest enemy
local function getClosestEnemy()
    local closestEnemy = nil
    local shortestDistance = math.huge
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            -- Only target enemies that are not on the same team
            if player.Team ~= myTeam then
                local distance = (player.Character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    closestEnemy = player.Character
                end
            end
        end
    end
    return closestEnemy
end

-- Aimbot
local aimbotEnabled = false
AimbotButton.MouseButton1Click:Connect(function()
    aimbotEnabled = not aimbotEnabled
    if aimbotEnabled then
        while aimbotEnabled do
            wait(0.1)
            local enemy = getClosestEnemy()
            if enemy then
                -- Aimbot: Aim at the enemy's HumanoidRootPart
                LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(enemy.HumanoidRootPart.Position)
            end
        end
    end
end)

-- ESP (Wallhack)
local espEnabled = false
local function createESP(player)
    local espBox = Instance.new("BillboardGui")
    espBox.Parent = player.Character.HumanoidRootPart
    espBox.Size = UDim2.new(0, 10, 0, 10)
    espBox.Adornee = player.Character.HumanoidRootPart
    espBox.AlwaysOnTop = true
    espBox.StudsOffset = Vector3.new(0, 2, 0)
    espBox.Enabled = true
end

ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        while espEnabled do
            wait(0.1)
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                    if player.Team ~= myTeam then
                        createESP(player)
                    end
                end
            end
        end
    end
end)

-- Function to display notification
local function sendNotification(title, text)
    StarterGui:SetCore("SendNotification", {
        Title = title;
        Text = text;
        Duration = 5;
    })
end

-- Notify user when the script is loaded successfully
sendNotification("Script Loaded", "Have Fun using 21 Cheats!")

-- Run the script and update it dynamically for changes
-- This will make sure the script is dynamic for any in-game updates

-- ESP cleanup for efficiency
game:GetService("RunService").RenderStepped:Connect(function()
    for _, player in pairs(Players:GetPlayers()) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local espPart = player.Character:FindFirstChild("ESPPart")
            if not espPart then
                local newESPPart = Instance.new("Part")
                newESPPart.Name = "ESPPart"
                newESPPart.Size = Vector3.new(1, 1, 1)
                newESPPart.Anchored = true
                newESPPart.CanCollide = false
                newESPPart.Parent = player.Character
                newESPPart.Transparency = 0.5
                newESPPart.Color = Color3.fromRGB(255, 0, 0)
                newESPPart.CFrame = player.Character.HumanoidRootPart.CFrame
            end
        end
    end
end)
