-- Load required services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- Notification Function
local function sendNotification(title, text, duration)
    StarterGui:SetCore("SendNotification", {
        Title = title;
        Text = text;
        Duration = duration or 5; -- Default duration of 5 seconds
    })
end

-- GUI Creation
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "21 Cheats"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 400)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.Parent = ScreenGui
MainFrame.Visible = false

local AimbotButton = Instance.new("TextButton")
AimbotButton.Size = UDim2.new(0, 200, 0, 50)
AimbotButton.Position = UDim2.new(0.5, -100, 0, 10)
AimbotButton.Text = "Toggle Aimbot"
AimbotButton.Parent = MainFrame

local ESPButton = Instance.new("TextButton")
ESPButton.Size = UDim2.new(0, 200, 0, 50)
ESPButton.Position = UDim2.new(0.5, -100, 0, 70)
ESPButton.Text = "Toggle ESP"
ESPButton.Parent = MainFrame

-- Toggle GUI Visibility with Insert Key
local guiVisible = false
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if input.KeyCode == Enum.KeyCode.Insert and not gameProcessedEvent then
        guiVisible = not guiVisible
        MainFrame.Visible = guiVisible
        sendNotification("GUI Toggle", guiVisible and "GUI Shown" or "GUI Hidden")
    end
end)

-- Enemy Detection Function
local function getEnemies()
    local enemies = {}
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Team ~= LocalPlayer.Team and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            table.insert(enemies, player.Character)
        end
    end
    return enemies
end

-- Aimbot Functionality
local aimbotEnabled = false
AimbotButton.MouseButton1Click:Connect(function()
    aimbotEnabled = not aimbotEnabled
    sendNotification("Aimbot", aimbotEnabled and "Aimbot Enabled" or "Aimbot Disabled")
end)

RunService.RenderStepped:Connect(function()
    if aimbotEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local enemies = getEnemies()
        if #enemies > 0 then
            local closestEnemy = enemies[1]
            local shortestDistance = (closestEnemy.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
            for _, enemy in pairs(enemies) do
                local distance = (enemy.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                if distance < shortestDistance then
                    closestEnemy = enemy
                    shortestDistance = distance
                end
            end
            -- Aimbot: Smooth aiming using CFrame.lookAt
            LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.lookAt(LocalPlayer.Character.HumanoidRootPart.Position, closestEnemy.HumanoidRootPart.Position)
        end
    end
end)

-- ESP Functionality
local espEnabled = false
local function createESP(player)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local existingESP = player.Character:FindFirstChild("ESPBox")
        if not existingESP then
            local espBox = Instance.new("BillboardGui")
            espBox.Name = "ESPBox"
            espBox.Size = UDim2.new(1, 0, 1, 0)
            espBox.Adornee = player.Character.HumanoidRootPart
            espBox.AlwaysOnTop = true
            espBox.Parent = player.Character

            local frame = Instance.new("Frame")
            frame.Size = UDim2.new(1, 0, 1, 0)
            frame.BackgroundColor3 = Color3.new(1, 0, 0)
            frame.BackgroundTransparency = 0.5
            frame.Parent = espBox
        end
    end
end

ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    sendNotification("ESP", espEnabled and "ESP Enabled" or "ESP Disabled")
end)

RunService.RenderStepped:Connect(function()
    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Team ~= LocalPlayer.Team then
                createESP(player)
            end
        end
    else
        for _, player in pairs(Players:GetPlayers()) do
            if player.Character then
                local existingESP = player.Character:FindFirstChild("ESPBox")
                if existingESP then
                    existingESP:Destroy()
                end
            end
        end
    end
end)

-- Initial Notification
sendNotification("Script Loaded", "Have Fun using 21 Cheats!")

